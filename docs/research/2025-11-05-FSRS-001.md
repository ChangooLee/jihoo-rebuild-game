# FSRS-001: FSRS Card 타입 안전화

**날짜**: 2025-11-05
**작업자**: Claude Code (Auto Task)
**태스크 ID**: FSRS-001
**리스크**: 낮음

---

## 목표

DEVELOP.md의 학습 엔진 안정성 강화를 위해 FSRS 관련 코드에서 `any` 타입을 제거하고 `Card` 타입을 명시적으로 사용합니다.

---

## 조사 결과

### 현재 상태 분석

1. **apps/web/lib/types.ts:44**
   - `ReviewState.fsrs: Card` - 이미 올바른 타입 선언
   - `import type { Card } from 'fsrs.js'` 사용 중

2. **apps/web/modules/fsrs/engine.ts**
   - `as any` 사용 없음 (grep으로 확인)
   - 이미 타입 안전한 구현:
     - `import { FSRS, Card, Rating } from 'fsrs.js'`
     - `type SchedulingResult = Record<Rating, { card: Card; log?: unknown }>`
     - 모든 Card 사용처가 명시적 타입

3. **apps/web/types/fsrs-js.d.ts**
   - `fsrs.js` 라이브러리에 대한 로컬 타입 선언
   - `Card` 클래스 구조 명시
   - `Rating` enum 선언
   - `FSRS.repeat` 반환 타입 정의

### fsrs.js 라이브러리

- **버전**: 1.0.0 (package.json)
- **공식 문서**: https://github.com/open-spaced-repetition/fsrs.js
- **라이선스**: MIT
- **핵심 타입**:
  - `Card`: 복습 카드의 상태 (due, stability, difficulty, reps, lapses 등)
  - `Rating`: 복습 결과 등급 (Again=0, Hard=1, Good=2, Easy=3)
  - `FSRS`: 분산학습 알고리즘 엔진

---

## 적용 가능성

### 현재 상태
✅ **이미 타입 안전화 완료됨**

모든 파일에서:
- `Card` 타입이 명시적으로 사용됨
- `as any` 캐스팅 없음
- 로컬 타입 선언 파일(`fsrs-js.d.ts`)로 타입 안정성 확보

### 추가 개선 가능 항목
1. **타입 선언 파일 검증**: `fsrs.js` 라이브러리 공식 타입과 비교하여 누락/불일치 확인
2. **Card 생성 개선**: `new Card()`보다는 라이브러리 제공 팩토리 함수 고려 (있다면)
3. **FSRS 파라미터 튜닝**: 기본 FSRS 인스턴스 대신 최적화된 파라미터 사용

---

## 디자인 트레이드오프

### 현재 접근 (로컬 타입 선언)
**장점**:
- `fsrs.js`가 TypeScript 타입 미제공 시 타입 안정성 확보
- 프로젝트 필요 범위만 선언하여 간결

**단점**:
- 라이브러리 업데이트 시 수동 동기화 필요
- 실제 API와 불일치 위험

### 대안 1: `@types/fsrs.js` 사용
- 커뮤니티 타입 정의가 있다면 사용
- 현재 DefinitelyTyped에 없음 (2025-11-05 기준)

### 대안 2: 라이브러리 공식 타입
- `fsrs.js` 1.0.0이 TypeScript로 작성되었다면 built-in 타입 사용
- 확인 필요: `node_modules/fsrs.js/dist/*.d.ts` 존재 여부

---

## 권장 사항

**우선순위 낮음**: 현재 코드는 이미 타입 안전합니다.

추후 개선 시 고려 사항:
1. `fsrs.js` 공식 타입 선언 여부 확인
2. `Card` 필드 추가/변경 시 `fsrs-js.d.ts` 업데이트
3. FSRS 파라미터 튜닝 (기본값 vs. 최적화)

---

## 참고 링크

- **fsrs.js GitHub**: https://github.com/open-spaced-repetition/fsrs.js
- **FSRS 알고리즘 논문**: https://github.com/open-spaced-repetition/fsrs4anki/wiki/The-Algorithm
- **TypeScript 타입 선언 가이드**: https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html

---

## 라이선스 확인

- ✅ `fsrs.js`: MIT License (상업적/비상업적 자유 사용)
- ✅ 로컬 타입 선언: 프로젝트 자체 작성 (MIT)

---

**결론**: FSRS-001 태스크는 이미 달성되어 있습니다. 추가 작업 불필요.
